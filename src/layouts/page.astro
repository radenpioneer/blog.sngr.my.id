---
import Layout from './layout.astro'
import type { CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'

interface Props {
  page: CollectionEntry<'blog'> | CollectionEntry<'page'>
}

const { page } = Astro.props
---

<Layout
  title={page.data.title}
  description={page.data.description ||
    (page.body.match(
      /^(?!#|!|(?:<[^>]*>|&lt;[^&]*&gt;).*$|\s*$).*/m
    )?.[0] as string)}
>
  <article>
    <h1 class="title">{page.data.title}</h1>
    {
      page.data.image && (
        <p class="image">
          <Image
            src={page.data.image}
            width={700}
            height={525}
            alt={page.data.title}
            loading="eager"
            decoding="async"
          />
        </p>
      )
    }
    <slot />
  </article>
</Layout>

<style lang="scss">
  @use '../styles/heading';

  .title {
    font-weight: 700;
  }

  .image {
    img {
      object-fit: cover;
      width: 100%;
      aspect-ratio: 4/3;
    }
  }

  :global(p) {
    @extend %serif;
  }

  @media (min-width: 576px) {
    .title {
      font-size: 3.5rem;
    }

    :global(p:not(.image):has(img)) {
      text-align: center;

      :global(img) {
        padding-left: 6rem;
        padding-right: 6rem;
        max-height: 400px;
        max-width: max-content;
        object-fit: contain;
      }
    }
  }

  @media (max-width: 576px) {
    .image {
      margin: 0 calc(var(--spacing) * -1) var(--spacing);
    }
  }
</style>
